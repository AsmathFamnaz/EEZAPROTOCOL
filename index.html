<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Group Console — Eeza Protocol</title>
<style>
body {
  background: #000;
  color: #b8d7ff;
  font-family: Arial, sans-serif;
  text-align: center;
  padding-top: 80px;
}
#timer {
  font-size: 60px;
  margin-top: 20px;
  color: #ff6b6b;
  text-shadow: 0 0 10px #ff0000;
}
.virus-banner {
  display: none;
  font-size: 40px;
  color: #00ff88;
  text-shadow: 0 0 15px #00ff66;
}
.virus-banner.show { display: block; }
</style>
</head>
<body>

<h1>Group Validation Console</h1>

<label>Group Number:
  <select id="groupSelect">
    <option value="">Select Group</option>
    <option value="1">Group 1</option>
    <option value="2">Group 2</option>
    <option value="3">Group 3</option>
    <option value="4">Group 4</option>
    <option value="5">Group 5</option>
    <option value="6">Group 6</option>
  </select>
</label>

<div id="timer">15:00</div>

<div style="margin-top:30px;">
  <input id="secretCode" placeholder="Enter Final Code">
  <button id="validateBtn">Validate</button>
</div>

<div id="virus" class="virus-banner">ACCESS GRANTED<br>Network Restored</div>

<script>
(() => {
  const VALID_CODES = {
    1: "CRYPTO",
    2: "SECRET",
    3: "OMEGA9",
    4: "ZENIX42",
    5: "SPY2025",
    6: "REDWALL"
  };

  const groupSelect = document.getElementById('groupSelect');
  const secretCode = document.getElementById('secretCode');
  const virus = document.getElementById('virus');
  const timerDisplay = document.getElementById('timer');

  let interval = null;
  let groupKey = null;
  let remaining = 0;
  const TOTAL = 15 * 60; // 15 min in seconds

  // Update display
  function updateDisplay() {
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    timerDisplay.textContent = `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  }

  // Load timer if existing
  function loadTimer() {
    if (!groupKey) return;
    const data = JSON.parse(localStorage.getItem(groupKey)) || {};
    remaining = data.remaining ?? TOTAL;
    if (data.started && !data.stopped) startCountdown();
    updateDisplay();
  }

  function startCountdown() {
    if (interval) clearInterval(interval);
    interval = setInterval(() => {
      if (remaining > 0) {
        remaining--;
        updateDisplay();
        const data = JSON.parse(localStorage.getItem(groupKey)) || {};
        data.remaining = remaining;
        localStorage.setItem(groupKey, JSON.stringify(data));
      } else {
        clearInterval(interval);
        alert('⛔ Time Over!');
      }
    }, 1000);
  }

  // React to controller commands
  window.addEventListener('storage', e => {
    if (e.key === groupKey && e.newValue) {
      const data = JSON.parse(e.newValue);
      if (data.started && !data.stopped && !interval) {
        remaining = data.remaining ?? TOTAL;
        startCountdown();
      }
      if (data.stopped) clearInterval(interval);
    }
  });

  // Validation success
  document.getElementById('validateBtn').addEventListener('click', () => {
    const g = groupSelect.value;
    const code = secretCode.value.trim().toUpperCase();
    if (!g) return alert("Select group first.");
    if (code === VALID_CODES[g]) {
      clearInterval(interval);
      virus.classList.add('show');
      const data = JSON.parse(localStorage.getItem(groupKey)) || {};
      data.stopped = true;
      data.validated = true;
      data.validatedAt = new Date().toLocaleTimeString();
      localStorage.setItem(groupKey, JSON.stringify(data));
      alert(`✅ Group ${g} validated!`);
    } else {
      alert("❌ Wrong code!");
    }
  });

  groupSelect.addEventListener('change', () => {
    groupKey = `group_${groupSelect.value}_timer`;
    loadTimer();
  });
})();
</script>
</body>
</html>
