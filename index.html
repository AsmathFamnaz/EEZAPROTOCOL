<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>The Final Gate — EEZA Protocol</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap');

  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('background.png') center/cover no-repeat;
    font-family: 'Inter', sans-serif;
    color: #e6eef8;
    overflow: hidden;
  }

  .card {
    background: rgba(15, 23, 36, 0.72);
    border: 1px solid rgba(125, 211, 252, 0.12);
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
    padding: 32px 40px;
    border-radius: 16px;
    backdrop-filter: blur(10px);
    text-align: center;
    max-width: 480px;
    width: 90%;
    animation: fadeIn 800ms ease;
  }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) } to { opacity: 1; transform: translateY(0) } }

  h3 {
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 2px;
    color: #7dd3fc;
    font-size: 1.5rem;
    margin: 4px 0 18px;
    text-shadow: 0 0 10px rgba(56,189,248,0.35);
  }

  #timerDisplay {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: #ff7b7b;
    text-shadow: 0 0 12px rgba(255,0,0,0.18);
    margin-bottom: 18px;
  }

  label {
    font-weight: 600;
    color: #aee0ff;
    display: block;
    margin-bottom: 6px;
  }

  select, input {
    width: 80%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    color: #e6eef8;
    font-size: 15px;
    margin: 6px 0 12px;
    outline: none;
    transition: box-shadow .18s, border-color .18s, transform .08s;
  }

  select:focus, input:focus {
    border-color: #7dd3fc;
    box-shadow: 0 0 10px rgba(56,189,248,0.12);
    transform: translateY(-1px);
  }

  .controls { margin-top: 6px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }

  button {
    padding: 11px 18px;
    font-size: 14px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, #2dd4bf, #7dd3fc);
    color: #042027;
    cursor: pointer;
    font-weight: 700;
    letter-spacing: .6px;
    text-transform: uppercase;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  }

  button:disabled {
    opacity: .45;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  button:not(:disabled):hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 24px rgba(34,211,238,0.12);
  }

  /* ACCESS GRANTED animation/banner */
  .virus-banner {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    background: rgba(0,0,0,0.25);
    padding: 30px 44px;
    border-radius: 12px;
    color: #b8ffb2;
    text-shadow: 0 0 22px #00ff66, 0 0 48px #00ff66;
    display: none;
    z-index: 1000;
    border: 1px solid rgba(0,255,102,0.08);
    backdrop-filter: blur(4px);
    animation: flickerMove 1.4s infinite;
  }

  .virus-banner.show { display:block; }

  @keyframes flickerMove {
    0%,100% { opacity: 1; transform: translate(-50%,-50%) scale(1) }
    50% { opacity: 0.78; transform: translate(-50%,-52%) scale(1.02) }
  }

  /* small responsive tweaks */
  @media (max-width:420px) {
    #timerDisplay { font-size: 22px; }
    .card { padding: 22px; }
    select, input { width: 90%; }
  }
</style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <div id="timerDisplay" aria-live="polite">Time Left: 15:00</div>
    <h3 id="title">THE FINAL GATE</h3>

    <form id="finalForm" autocomplete="off" onsubmit="return false" aria-describedby="instructions">
      <div id="instructions" style="font-size:13px;color:#bfeeff;margin-bottom:10px;">
        Select your group, press <strong>Start</strong> to begin the 15-minute run, then enter the secret code to validate.
      </div>

      <label for="groupSelect">Select Group</label>
      <select id="groupSelect" aria-required="true" aria-label="Select group">
        <option value="">-- Choose Group --</option>
        <option value="1">Group 1</option>
        <option value="2">Group 2</option>
        <option value="3">Group 3</option>
        <option value="4">Group 4</option>
        <option value="5">Group 5</option>
        <option value="6">Group 6</option>
      </select>

      <div class="controls">
        <button id="startBtn" type="button" disabled>Start Timer</button>
        <input id="secretCode" type="text" maxlength="20" placeholder="Enter secret code" aria-label="Secret code" />
        <button id="checkBtn" type="button">Validate Code</button>
      </div>
    </form>
  </div>

  <div id="virus" class="virus-banner" role="status" aria-live="assertive">
    <div style="font-size:56px; margin-bottom:8px; line-height:0.9;">ACCESS GRANTED</div>
    <div style="font-size:20px; opacity:0.95;">Network Restored</div>
  </div>

<script>
(() => {
  const VALID_CODES = {1:"CRYPTO",2:"SECRET",3:"OMEGA9",4:"ZENIX42",5:"SPY2025",6:"REDWALL"};
  const groupSelect = document.getElementById('groupSelect');
  const secretCode = document.getElementById('secretCode');
  const virus = document.getElementById('virus');
  const timerDisplay = document.getElementById('timerDisplay');
  const startBtn = document.getElementById('startBtn');
  const checkBtn = document.getElementById('checkBtn');

  const TOTAL = 15 * 60;
  let timeLeft = TOTAL;
  let timer = null;
  let groupKey = null;

  function formatTime(t) {
    const m = Math.floor(t/60), s = t%60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  function updateTimerDisplay() {
    timerDisplay.textContent = `Time Left: ${formatTime(timeLeft)}`;
  }

  function saveTimer() {
    if (!groupKey) return;
    const data = JSON.parse(localStorage.getItem(groupKey)) || {};
    data.remaining = timeLeft;
    data.started = true;
    localStorage.setItem(groupKey, JSON.stringify(data));
  }

  function startCountdown() {
    if (!groupKey) return;
    if (timer) clearInterval(timer);
    timer = setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        saveTimer();
        updateTimerDisplay();
      } else {
        clearInterval(timer);
        timer = null;
        timeLeft = 0;
        updateTimerDisplay();
        timerDisplay.textContent = '⛔ Time Over!';
      }
    }, 1000);
  }

  // enable/disable Start button depending on group selection
  function refreshControls() {
    if (groupSelect.value) startBtn.disabled = false;
    else startBtn.disabled = true;
  }

  groupSelect.addEventListener('change', () => {
    // set groupKey & load saved time if exists
    if (!groupSelect.value) {
      groupKey = null;
      timeLeft = TOTAL;
      updateTimerDisplay();
      refreshControls();
      return;
    }
    groupKey = `group_${groupSelect.value}_timer`;
    const saved = JSON.parse(localStorage.getItem(groupKey));
    timeLeft = (saved && saved.remaining != null) ? saved.remaining : TOTAL;
    // if already validated for this group, disable controls
    if (saved && saved.validated) {
      // show banner if already validated (optional)
      virus.classList.add('show');
      startBtn.disabled = true;
      groupSelect.disabled = true;
      secretCode.disabled = true;
      checkBtn.disabled = true;
    } else {
      virus.classList.remove('show');
      secretCode.disabled = false;
      checkBtn.disabled = false;
      refreshControls();
    }
    updateTimerDisplay();
  });

  startBtn.addEventListener('click', () => {
    if (!groupSelect.value) return; // safeguard
    // ensure we use saved remaining if any (so pressing start multiple times won't reset unexpectedly)
    const saved = JSON.parse(localStorage.getItem(groupKey));
    timeLeft = (saved && saved.remaining != null) ? saved.remaining : TOTAL;
    updateTimerDisplay();
    startCountdown();
    // prevent double-start UI feedback
    startBtn.disabled = true;
    groupSelect.disabled = true;
  });

  checkBtn.addEventListener('click', () => {
    if (!groupSelect.value) return;
    const code = (secretCode.value || '').trim().toUpperCase();
    if (code === VALID_CODES[groupSelect.value]) {
      // stop timer and show banner only
      if (timer) { clearInterval(timer); timer = null; }
      virus.classList.add('show');
      secretCode.value = '';
      // disable controls after success
      startBtn.disabled = true;
      checkBtn.disabled = true;
      secretCode.disabled = true;
      groupSelect.disabled = true;

      // Save validation and time taken
      const saved = JSON.parse(localStorage.getItem(groupKey)) || {};
      saved.stopped = true;
      saved.validated = true;
      saved.timeTaken = TOTAL - (timeLeft || 0);
      saved.validatedAt = new Date().toLocaleTimeString();
      localStorage.setItem(groupKey, JSON.stringify(saved));
      // don't show alerts — only the banner
    } else {
      // wrong code — clear input and give subtle shake (accessibility-friendly)
      secretCode.value = '';
      secretCode.focus();
      // small visual cue: brief red border
      secretCode.style.borderColor = 'rgba(255,80,80,0.9)';
      setTimeout(()=> secretCode.style.borderColor = '', 700);
    }
  });

  // On load, auto-resume any started-but-not-stopped group (prefer the first found)
  window.addEventListener('load', () => {
    // find any group that has started and not stopped
    let found = null;
    for (let i = 1; i <= 6; i++) {
      const key = `group_${i}_timer`;
      const data = JSON.parse(localStorage.getItem(key));
      if (data && data.started && !data.stopped) {
        found = { i, data };
        break;
      }
    }
    if (found) {
      // restore selection to that group and resume
      groupSelect.value = String(found.i);
      groupKey = `group_${found.i}_timer`;
      timeLeft = found.data.remaining != null ? found.data.remaining : TOTAL;
      updateTimerDisplay();
      // small delay so UI settles, then resume
      setTimeout(() => {
        startCountdown();
        // lock selection (but keep start disabled already)
        groupSelect.disabled = true;
        startBtn.disabled = true;
      }, 200);
    } else {
      // no running timers — ensure UI is in initial state
      groupSelect.value = '';
      groupKey = null;
      timeLeft = TOTAL;
      updateTimerDisplay();
      refreshControls();
      virus.classList.remove('show');
    }
  });

  // ensure Start button state is correct initially (for browsers that restore form values)
  refreshControls();
})();
</script>
</body>
</html>
